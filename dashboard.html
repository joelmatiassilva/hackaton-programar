
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Análisis geolocalizado de las TIC</title>
    <style>
            #map_canvas { 
              width: 100%; height: 800px; 
            }
    
          .container_map{
             width: 60%;
             float: left;
          }

          .control-group{
            float:left;
	    width: 35%;

          }

	  .container_grafico{
	    width: 100%;
	  }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Mini and minimalist.">
    <meta name="author" content="Thomas Park">

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/bootswatch.css" rel="stylesheet">

   <script type="text/javascript">

     var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-23019901-1']);
      _gaq.push(['_setDomainName', "bootswatch.com"]);
        _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

     (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
     })();

   </script>

  </head>

  <body id="top" data-spy="scroll" data-target=".subnav" data-offset="80" onload="initialize(); " style="margin-top: 40px;">
        <script src="js/underscore-min.js"></script>
     <script type="text/javascript" src="js/bsa.js"></script>
     <script type="text/javascript" src="js/hogarProvincia.js"></script>
     <script type="text/javascript" src="https://www.google.com/jsapi"></script>
     <script type="text/javascript" src="js/graficos.js"></script>	
 
  <!-- Navbar
    ================================================== -->
 <div class="navbar navbar-fixed-top">
   <div class="navbar-inner">
     <div class="container">
       <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
       </a>
       <a class="brand" href="../">Análisis geolocalizado de las TIC</a>
       <div class="nav-collapse collapse" id="main-menu">
        <ul class="nav" id="main-menu-left">
          <li><a onclick="pageTracker._link(this.href); return false;" href="http://news.bootswatch.com">Mapa</a></li>
          <li><a onclick="pageTracker._link(this.href); return false;" href="http://news.bootswatch.com">Descargar App</a></li>
          
        </ul>

       </div>
     </div>
   </div>
 </div>

  <div class="container_map">
    <div id="map_canvas"></div>

    </div><!-- /container -->
   <div class="control-group">
    <label class="control-label" for="select01">Datos por hogar de:</label>
    <div class="controls">
      <select id="select01">
        <option value="h6_1">Lineas de celular activas</option>
        <option value="h8_a">Computadoras de escritorio</option>
        <option value="h8_b">Computadoras portátiles</option>
        <option value="h11">Razones por las cuales no hay internet</option>
      </select>
    </div>
    <div class="container_grafico" id="grafico_div"></div>
  </div>


    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

    <script src="js/jquery.smooth-scroll.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootswatch.js"></script>    <script type="text/javascript" src="http://www.google.com/jsapi"></script>        
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="http://geoxml3.googlecode.com/svn/branches/polys/geoxml3.js"></script>
<script type="text/javascript">
  google.load('visualization', '1', {'packages':['corechart', 'table', 'geomap']});
var map;

var layer;
var tableid =  "14iHz800h6FbXgdQOzqcYrIvTHMoHUV2nZsmq1rM"; //1265695;
var prov_actual;

$("#select01").change(function () {
  var value = "";
  $( "#select01 option:selected" ).each(function() {
    value = $( this ).val();
  });
  if (prov_actual){
    graficar (value, prov_actual);
  }
});


function initialize() {
    geocoder = new google.maps.Geocoder();
    map = new google.maps.Map(document.getElementById('map_canvas'), {
    center: new google.maps.LatLng(-38.416097, -63.616672),
    zoom: 4,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  });
  
  layer = new google.maps.FusionTablesLayer();
    layer.setOptions({
        query: {
                select: 'geometry',
                from: tableid
               },
    suppressInfoWindows:true

  });
  layer.setMap(map);
  
  google.maps.event.addListener(layer, 'click', function(e){
      console.log(getProvinciaValue(e));
      console.log(hogarProvincia.getByField(getProvinciaValue(e), "h7", hogarProvincia.jurisdiccion));
      prov_actual = getProvinciaValue(e);
      $( "#select01 option:selected" ).each(function() {
        value = $( this ).val();
      });
      graficar (value, prov_actual);
 });

}

function getProvinciaValue(e){ 
  return e.row.provincia.value;
}     

function changeMap() {
  var searchString = document.getElementById('searchString').value.replace("'", "\\'");
  if(searchString == "") {
    //var query="SELECT 'geometry' FROM " + tableid;
  } else {
    var query="SELECT 'geometry' FROM " + tableid + " WHERE name = '" + searchString + "'";

  layer.setOptions({
    query: {
            select: 'geometry',
            from: tableid,
            where:" name = '" + searchString + "'"
           }

    });
    
      
  }

  layer.setMap(map);
  zoom2query(query);

}

function changeMap2() {
  var searchString2 = document.getElementById('searchString2').value.replace("'", "\\'");
  if(searchString2 == "") {
    var query="SELECT 'geometry' FROM " + tableid2;
  } else {
    var query="SELECT 'geometry' FROM " + tableid2 + " WHERE 'name' = '" + searchString2 + "'";
  }
  //layer2.setQuery(query);
  zoom2query(query);
  
}



var infowindow = new google.maps.InfoWindow();
    


function zoom2query(query) {
// zoom and center map on query results
  //set the query using the parameter
  var queryText = encodeURIComponent(query);
  var query = new google.visualization.Query('http://www.google.com/fusiontables/gvizdata?tq='  + queryText);
  console.log(query);

  //set the callback function
  query.send(zoomTo);
  console.log("test");
}

function zoomTo(response) {
if (!response) {
  alert('no response');
  return;
}
if (response.isError()) {
  alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
  return;
} 
  FTresponse = response;
  //for more information on the response object, see the documentation
  //http://code.google.com/apis/visualization/documentation/reference.html#QueryResponse
  numRows = response.getDataTable().getNumberOfRows();
  numCols = response.getDataTable().getNumberOfColumns();
  
     var kml =  FTresponse.getDataTable().getValue(0,0);
     // create a geoXml3 parser for the click handlers
     var geoXml = new geoXML3.parser({
                    map: map,
        zoom: false
                });

     geoXml.parseKmlString("<Placemark>"+kml+"</Placemark>");
     //console.log(kml);
     geoXml.docs[0].gpolygons[0].setMap(null);
     console.log(geoXml.docs[0].gpolygons[0].bounds);
     map.fitBounds(geoXml.docs[0].gpolygons[0].bounds);


 /* var bounds = new google.maps.LatLngBounds();
  for(i = 0; i < numRows; i++) {
      var point = new google.maps.LatLng(
          parseFloat(response.getDataTable().getValue(i, 0)),
          parseFloat(response.getDataTable().getValue(i, 1)));
      bounds.extend(point);
  }
  // zoom to the bounds
  map.fitBounds(bounds);*/

}



        </script>

  </body>
</html>

